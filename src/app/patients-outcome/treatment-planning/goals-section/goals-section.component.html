<section class="card goals-card">
  <div class="goals-card-header">
    <div>
      <p class="section-eyebrow">Goals</p>
      <p class="section-helper">Define individualized outcomes to guide the rehab plan</p>
    </div>

    <div class="search-container" role="search">
      <input type="search" class="search-input" placeholder="Search goals" aria-label="Search goals" autocomplete="off"
        [(ngModel)]="searchTerm" />
      <fa-icon [icon]="faSearch" class="search-icon" aria-hidden="true"></fa-icon>
    </div>

    <button type="button" (click)="addGoal.emit()" class="btn-primary goals-add-button">
      + Add goal
    </button>
  </div>

  <div class="goals-tab-group">
    <button *ngFor="let tab of tabs" type="button" (click)="onTabSelect(tab.id)" class="goal-tab"
      [ngClass]="{ 'goal-tab-active': tab.id === activeTab }">
      <span>{{ tab.label }}</span>
      <span class="goal-tab-count" [ngClass]="{ 'goal-tab-count-active': tab.id === activeTab }">
        {{ countGoals(tab.id) }}
      </span>
    </button>
  </div>

  <div class="goal-list" *ngIf="filteredGoals.length; else noGoals">
    <article *ngFor="let goal of filteredGoals; trackBy: trackGoalById" class="goal-card">
      <div class="goal-card-header">
        <div>
          <p class="goal-title">{{ goal.name }}</p>
          <p class="goal-description">{{ goal.desc }}</p>
        </div>
        <div class="goal-actions" role="group" aria-label="Goal actions">
          <ng-container *ngIf="['planned', 'archived', 'onhold', 'ongoing'].includes(goal.status)">
            <button type="button" aria-label="Edit goal" (click)="editGoal.emit(goal)" class="goal-action-button">
              <fa-icon [icon]="faPenToSquare" aria-hidden="true"></fa-icon>
              <!-- <span>Edit</span> -->
            </button>
          </ng-container>
          <ng-container>
            <button type="button" aria-label="Delete goal" (click)="deleteGoal.emit(goal)"
              class="goal-action-button goal-action-delete">
              <fa-icon [icon]="faTrashCan" aria-hidden="true"></fa-icon>
              <!-- <span>Delete</span> -->
            </button>
          </ng-container>
          <ng-container *ngIf="goal.status === 'onhold'">
            <button type="button" aria-label="Reactivate goal" (click)="reactivateGoal.emit(goal)"
              class="goal-action-button goal-action-reactivate">
              <fa-icon [icon]="faRotateLeft" aria-hidden="true"></fa-icon>
              <!-- <span>Reactivate</span> -->
            </button>
          </ng-container>
        </div>
      </div>
      <div class="goal-meta">
        <div class="goal-meta-item">
          <span class="goal-meta-label">Target date</span>
          <span class="goal-meta-value">{{ goal.tDate | date:'MMM d, y' }}</span>
        </div>
        <div class="goal-meta-item">
          <span class="goal-meta-label">Status</span>
          <span class="goal-status" [ngClass]="getStatusClass(goal.status)">
            {{ getStatusLabel(goal.status) }}
          </span>
        </div>
      </div>
    </article>
  </div>

  <ng-template #noGoals>
    <div class="goals-empty-state">
      No goals captured for this horizon yet. Add a goal to kickstart the plan.
    </div>
  </ng-template>
</section>

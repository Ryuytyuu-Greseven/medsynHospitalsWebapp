<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">


    <!-- Medication Insights -->
    <div class="mb-6">
      <app-card class="hover-lift h-fit" [customeClass]="'min-h-[300px]'">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-bold text-gray-900">Medication Insights</h3>
          <fa-icon [icon]="faExclamationTriangle" class="w-5 h-5 text-blue-600"></fa-icon>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-2 gap-3 mb-3">
          <div class="bg-blue-50 rounded-lg p-3 text-center">
            <div class="text-xl font-bold text-blue-600">{{ medications.length }}</div>
            <div class="text-xs text-blue-700">Active Meds</div>
          </div>
          <div class="bg-green-50 rounded-lg p-3 text-center">
            <div class="text-xl font-bold text-green-600">{{ getUpcomingRefills() }}</div>
            <div class="text-xs text-green-700">Refills Due</div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div>
          <h4 class="text-sm font-semibold text-gray-700 mb-2">Recent Activity</h4>
          <div class="space-y-1">
            <div *ngFor="let activity of getRecentActivity()" class="flex items-center gap-2 text-xs text-gray-600">
              <fa-icon [icon]="activity.icon" class="w-3 h-3" [class]="activity.colorClass"></fa-icon>
              <span>{{ activity.description }}</span>
            </div>
          </div>
        </div>
      </app-card>
    </div>

    <!-- Quick Actions -->
    <div class="mb-6">
      <app-card class="hover-lift h-fit" [customeClass]="'min-h-[300px]'">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-bold text-gray-900">Quick Actions</h3>
          <fa-icon [icon]="faPlus" class="w-5 h-5 text-green-600"></fa-icon>
        </div>

        <div class="space-y-2">
          <button (click)="openImageUpload()" class="w-full p-2.5 bg-blue-50 hover:bg-blue-100 rounded-lg border border-blue-200 transition-colors text-left">
            <div class="flex items-center gap-3">
              <fa-icon [icon]="faCamera" class="w-4 h-4 text-blue-600"></fa-icon>
              <div>
                <div class="font-medium text-gray-900 text-sm">Scan Prescription</div>
                <div class="text-xs text-gray-600">Upload image or PDF</div>
              </div>
            </div>
          </button>

          <button (click)="openAddMedicationModal()" class="w-full p-2.5 bg-green-50 hover:bg-green-100 rounded-lg border border-green-200 transition-colors text-left">
            <div class="flex items-center gap-3">
              <fa-icon [icon]="faPills" class="w-4 h-4 text-green-600"></fa-icon>
              <div>
                <div class="font-medium text-gray-900 text-sm">Add Manually</div>
                <div class="text-xs text-gray-600">Enter details manually</div>
              </div>
            </div>
          </button>

          <button (click)="exportMedications()" class="w-full p-2.5 bg-purple-50 hover:bg-purple-100 rounded-lg border border-purple-200 transition-colors text-left">
            <div class="flex items-center gap-3">
              <fa-icon [icon]="faDownload" class="w-4 h-4 text-purple-600"></fa-icon>
              <div>
                <div class="font-medium text-gray-900 text-sm">Export List</div>
                <div class="text-xs text-gray-600">Download medication list</div>
              </div>
            </div>
          </button>
        </div>
      </app-card>
    </div>

    <!-- Nutrition & Activity -->
    <div class="mb-6">
      <app-card class="hover-lift h-fit" [customeClass]="'min-h-[300px]'">
        <h3 class="text-lg font-bold text-gray-900 mb-3">Daily Nutrition & Activity</h3>

        <!-- Nutrition Stats -->
        <div class="mb-4">
          <h4 class="text-sm font-semibold text-gray-700 mb-2">Nutrition Intake</h4>
          <div class="grid grid-cols-4 gap-2">
            <!-- Calories -->
            <div class="text-center p-2 bg-orange-50 rounded-lg border border-orange-200">
              <div class="text-lg font-bold text-orange-600">1,850</div>
              <div class="text-xs text-orange-700">Calories</div>
            </div>

            <!-- Protein -->
            <div class="text-center p-2 bg-blue-50 rounded-lg border border-blue-200">
              <div class="text-lg font-bold text-blue-600">85g</div>
              <div class="text-xs text-blue-700">Protein</div>
            </div>

            <!-- Carbs -->
            <div class="text-center p-2 bg-yellow-50 rounded-lg border border-yellow-200">
              <div class="text-lg font-bold text-yellow-600">120g</div>
              <div class="text-xs text-yellow-700">Carbs</div>
            </div>

            <!-- Fat -->
            <div class="text-center p-2 bg-purple-50 rounded-lg border border-purple-200">
              <div class="text-lg font-bold text-purple-600">65g</div>
              <div class="text-xs text-purple-700">Fat</div>
            </div>
          </div>
        </div>

        <!-- Activity & Burning -->
        <div>
          <h4 class="text-sm font-semibold text-gray-700 mb-2">Activity & Burning</h4>
          <div class="grid grid-cols-4 gap-2">
            <!-- Calories Burned -->
            <div class="text-center p-2 bg-red-50 rounded-lg border border-red-200">
              <div class="text-lg font-bold text-red-600">420</div>
              <div class="text-xs text-red-700">Calories Burned</div>
            </div>

            <!-- Steps -->
            <div class="text-center p-2 bg-green-50 rounded-lg border border-green-200">
              <div class="text-lg font-bold text-green-600">6,250</div>
              <div class="text-xs text-green-700">Steps</div>
            </div>

            <!-- Distance -->
            <div class="text-center p-2 bg-blue-50 rounded-lg border border-blue-200">
              <div class="text-lg font-bold text-blue-600">3.2</div>
              <div class="text-xs text-blue-700">Miles</div>
            </div>

            <!-- Active Minutes -->
            <div class="text-center p-2 bg-purple-50 rounded-lg border border-purple-200">
              <div class="text-lg font-bold text-purple-600">45</div>
              <div class="text-xs text-purple-700">Active Minutes</div>
            </div>
          </div>
        </div>
      </app-card>
    </div>

    <!-- Current Diet -->
    <div class="mb-6">
      <app-card class="hover-lift h-fit" [customeClass]="'min-h-[300px]'">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-bold text-gray-900">Current Diet Plan</h3>
        <span class="text-xs text-gray-500">Active plan</span>
      </div>

      <div>
        <!-- Diet Plan Card -->
        <div class="bg-green-50 rounded-lg border border-green-200 p-3">
          <div class="flex items-center gap-3 mb-2">
            <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center">
              <span class="text-green-600 text-xs">ðŸ¥—</span>
            </div>
            <div>
              <h4 class="font-bold text-gray-900 text-sm">Diabetes Management Diet</h4>
              <p class="text-xs text-gray-600">Low-carb, high-protein plan</p>
            </div>
          </div>
          <div class="text-xs text-gray-600">
            <p>Started: Jan 15, 2024</p>
            <p>Notes: Focus on blood sugar control</p>
          </div>
        </div>
      </div>
    </app-card>
    </div>


  <!-- Left Side - Medications -->
  <div class="lg:col-span-2 space-y-6">

    <!-- Current Medications -->
    <div class="mb-6">
      <app-card class="hover-lift">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-900">Current Medications</h3>
        <div class="flex items-center gap-2">
          <span class="text-xs text-gray-500">{{ medications.length || 0 }} active</span>
          <button (click)="openMedicationsModal()" class="text-xs text-blue-600 hover:text-blue-800 font-medium">View All</button>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!medications || medications.length === 0" class="text-center py-6">
        <div class="w-10 h-10 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-2">
          <fa-icon [icon]="faPills" class="w-5 h-5 text-gray-400"></fa-icon>
        </div>
        <p class="text-gray-500 text-sm">No active medications</p>
      </div>

      <!-- Medications Grid Layout -->
      <div *ngIf="medications && medications.length > 0" class="grid grid-cols-4 gap-4 px-4 md:px-6 xl:px-8">
        <div *ngFor="let med of medications; let i = index" class="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-sm transition-all relative">
          <!-- Active Status Indicator -->
          <div *ngIf="med.status === 'active'" class="absolute top-2 right-2 w-2 h-2 bg-green-500 rounded-full"></div>

          <div class="flex flex-col items-center text-center">
            <h4 class="font-semibold text-gray-900 text-sm mb-2 truncate w-full">{{ med.name }}</h4>
            <div class="text-xs text-gray-600 space-y-1">
              <div class="font-medium">{{ med.dosage }}</div>
              <div>{{ med.frequency }}</div>
              <div class="mt-2 text-xs text-gray-500">
                <p>{{ formatDate(med.startDate) }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Show More Button -->
      <div *ngIf="medications.length > 8" class="text-center pt-3">
        <button class="text-sm text-blue-600 hover:text-blue-800 font-medium">
          Show {{ medications.length - 8 }} more medications
        </button>
      </div>
    </app-card>
    </div>

    <!-- Previous Medications -->
    <div class="mb-6">
      <app-card class="hover-lift">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-900">Previous Medications</h3>
        <div class="flex items-center gap-2">
          <span class="text-xs text-gray-500">0 discontinued</span>
          <button class="text-xs text-blue-600 hover:text-blue-800 font-medium">View All</button>
        </div>
      </div>

      <div class="text-center py-6">
        <div class="w-10 h-10 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-2">
          <fa-icon [icon]="faCheckCircle" class="w-5 h-5 text-gray-400"></fa-icon>
        </div>
        <p class="text-gray-500 text-sm">No previous medications</p>
      </div>
    </app-card>
    </div>
  </div>

  <!-- Right Side - Quick Actions & Insights -->
  <div class="space-y-6">

  </div>
</div>

<!-- Medications Modal -->
<div *ngIf="showMedicationsModal" class="fixed inset-0 z-50 overflow-y-auto" (click)="closeMedicationsModal()">
  <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <!-- Background overlay -->
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

    <!-- Modal panel -->
    <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="bg-white px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
              <fa-icon [icon]="faPills" class="w-4 h-4 text-blue-600"></fa-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-900">All Medications</h3>
              <p class="text-sm text-gray-500">Complete medication history and management</p>
            </div>
          </div>
          <button (click)="closeMedicationsModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
            <fa-icon [icon]="faTimes" class="w-6 h-6"></fa-icon>
          </button>
        </div>

        <!-- Search and Filter Bar -->
        <div class="mt-4 flex flex-col sm:flex-row gap-4">
          <div class="flex-1">
            <div class="relative">
              <input
                type="text"
                [(ngModel)]="medicationSearchTerm"
                (input)="filterMedications()"
                placeholder="Search medications..."
                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <fa-icon [icon]="faSearch" class="absolute left-3 top-2.5 h-4 w-4 text-gray-400"></fa-icon>
            </div>
          </div>
          <div class="flex gap-2">
            <select [(ngModel)]="selectedStatusFilter" (change)="filterMedications()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="discontinued">Discontinued</option>
              <option value="paused">Paused</option>
            </select>
            <button (click)="openImageUpload()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
              <fa-icon [icon]="faCamera" class="w-4 h-4"></fa-icon>
              Scan Prescription
            </button>
          </div>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="bg-gray-50 px-6 py-4 max-h-96 overflow-y-auto">
        <!-- Current Medications Section -->
        <div class="mb-6">
          <h4 class="text-md font-semibold text-gray-900 mb-3 flex items-center gap-2">
            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
            Current Medications ({{ getFilteredMedications('active').length }})
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div *ngFor="let med of getFilteredMedications('active')" class="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-sm transition-all">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <h5 class="font-semibold text-gray-900">{{ med.name }}</h5>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                      Active
                    </span>
                  </div>
                  <div class="space-y-1 text-sm text-gray-600">
                    <p><span class="font-medium">Dosage:</span> {{ med.dosage }}</p>
                    <p><span class="font-medium">Frequency:</span> {{ med.frequency }}</p>
                    <p><span class="font-medium">Started:</span> {{ formatDate(med.startDate) }}</p>
                    <p *ngIf="med.prescribedBy"><span class="font-medium">Prescribed by:</span> {{ med.prescribedBy }}</p>
                    <p *ngIf="med.notes" class="text-xs text-gray-500 mt-2 p-2 bg-gray-50 rounded">
                      <span class="font-medium">Notes:</span> {{ med.notes }}
                    </p>
                  </div>
                </div>
                <div class="flex flex-col gap-1 ml-4">
                  <button (click)="viewPrescription(med)" class="p-1 text-green-600 hover:text-green-800 transition-colors" title="View Prescription">
                    <fa-icon [icon]="faEye" class="w-4 h-4"></fa-icon>
                  </button>
                  <button (click)="editMedication(med)" class="p-1 text-blue-600 hover:text-blue-800 transition-colors" title="Edit">
                    <fa-icon [icon]="faEdit" class="w-4 h-4"></fa-icon>
                  </button>
                  <button (click)="discontinueMedication(med)" class="p-1 text-red-600 hover:text-red-800 transition-colors" title="Discontinue">
                    <fa-icon [icon]="faTimes" class="w-4 h-4"></fa-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Previous/Discontinued Medications Section -->
        <div *ngIf="getFilteredMedications('discontinued').length > 0">
          <h4 class="text-md font-semibold text-gray-900 mb-3 flex items-center gap-2">
            <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
            Previous Medications ({{ getFilteredMedications('discontinued').length }})
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div *ngFor="let med of getFilteredMedications('discontinued')" class="bg-white rounded-lg border border-gray-200 p-4 opacity-75">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <h5 class="font-semibold text-gray-900">{{ med.name }}</h5>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      Discontinued
                    </span>
                  </div>
                  <div class="space-y-1 text-sm text-gray-600">
                    <p><span class="font-medium">Dosage:</span> {{ med.dosage }}</p>
                    <p><span class="font-medium">Duration:</span> {{ formatDate(med.startDate) }} - {{ med.endDate ? formatDate(med.endDate) : 'Ongoing' }}</p>
                    <p *ngIf="med.discontinueReason" class="text-xs text-gray-500 mt-2 p-2 bg-gray-50 rounded">
                      <span class="font-medium">Reason:</span> {{ med.discontinueReason }}
                    </p>
                  </div>
                </div>
                <div class="flex flex-col gap-1 ml-4">
                  <button (click)="viewMedicationHistory(med)" class="p-1 text-gray-600 hover:text-gray-800 transition-colors" title="View History">
                    <fa-icon [icon]="faHistory" class="w-4 h-4"></fa-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="getFilteredMedications('all').length === 0" class="text-center py-8">
          <div class="w-16 h-16 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-4">
            <fa-icon [icon]="faSearch" class="w-8 h-8 text-gray-400"></fa-icon>
          </div>
          <p class="text-gray-500">No medications found matching your search criteria</p>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="bg-gray-50 px-6 py-3 flex justify-between items-center border-t border-gray-200">
        <div class="text-sm text-gray-500">
          Total: {{ getAllMedications().length }} medications
        </div>
        <div class="flex gap-3">
          <button (click)="exportMedications()" class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
            Export List
          </button>
          <button (click)="closeMedicationsModal()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Image Upload Modal -->
<div *ngIf="showImageUploadModal" class="fixed inset-0 z-50 overflow-y-auto" (click)="closeImageUploadModal()">
  <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <!-- Background overlay -->
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

    <!-- Modal panel -->
    <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="bg-white px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
              <fa-icon [icon]="faCamera" class="w-4 h-4 text-blue-600"></fa-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-900">Upload Prescription</h3>
              <p class="text-sm text-gray-500">AI will automatically extract medication details</p>
            </div>
          </div>
          <button (click)="closeImageUploadModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
            <fa-icon [icon]="faTimes" class="w-6 h-6"></fa-icon>
          </button>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="bg-white px-6 py-4">
        <!-- Upload Area -->
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors cursor-pointer"
             (click)="triggerFileInput()"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave($event)"
             (drop)="onDrop($event)">
          <fa-icon [icon]="faCamera" class="w-12 h-12 mx-auto text-gray-400 mb-4"></fa-icon>
          <p class="text-lg font-medium text-gray-700 mb-2">Upload Prescription Image</p>
          <p class="text-sm text-gray-500 mb-4">Drag and drop or click to browse</p>
          <p class="text-xs text-gray-400">Supports JPG, PNG, PDF files up to 10MB</p>
          <input #fileInput type="file" accept=".jpg,.jpeg,.png,.pdf" class="hidden" (change)="onFileSelected($event)">
        </div>

        <!-- Preview -->
        <div *ngIf="uploadedImage" class="mt-4">
          <h4 class="text-sm font-medium text-gray-700 mb-2">Uploaded Image</h4>
          <div class="relative">
            <img [src]="uploadedImage" alt="Prescription preview" class="w-full h-48 object-cover rounded-lg border">
            <button (click)="removeUploadedImage()" class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors">
              <fa-icon [icon]="faTimes" class="w-3 h-3"></fa-icon>
            </button>
          </div>
        </div>

        <!-- AI Processing -->
        <div *ngIf="isProcessingImage" class="mt-4 p-4 bg-purple-50 rounded-lg border border-purple-200">
          <div class="flex items-center gap-3">
            <div class="animate-spin">
              <fa-icon [icon]="faExclamationTriangle" class="w-5 h-5 text-purple-600"></fa-icon>
            </div>
            <div>
              <p class="text-sm font-medium text-purple-900">AI is analyzing your prescription...</p>
              <p class="text-xs text-purple-700">Extracting medication details automatically</p>
            </div>
          </div>
        </div>

        <!-- Extracted Data Preview -->
        <div *ngIf="extractedMedicationData" class="mt-4 p-4 bg-green-50 rounded-lg border border-green-200">
          <h4 class="text-sm font-semibold text-green-800 mb-2">Extracted Information</h4>
          <div class="space-y-2 text-sm">
            <div><span class="font-medium">Medication:</span> {{ extractedMedicationData.name }}</div>
            <div><span class="font-medium">Dosage:</span> {{ extractedMedicationData.dosage }}</div>
            <div><span class="font-medium">Frequency:</span> {{ extractedMedicationData.frequency }}</div>
            <div *ngIf="extractedMedicationData.instructions"><span class="font-medium">Instructions:</span> {{ extractedMedicationData.instructions }}</div>
          </div>
          <div class="mt-3 flex gap-2">
            <button (click)="confirmExtractedData()" class="px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 transition-colors">
              Confirm & Add
            </button>
            <button (click)="editExtractedData()" class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors">
              Edit Details
            </button>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="bg-gray-50 px-6 py-3 flex justify-end gap-3 border-t border-gray-200">
        <button (click)="closeImageUploadModal()" class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
          Cancel
        </button>
        <button (click)="processImage()" [disabled]="!uploadedImage || isProcessingImage" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
          <fa-icon [icon]="faExclamationTriangle" class="w-4 h-4"></fa-icon>
          Process with AI
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add Medication Modal -->
<div *ngIf="showAddMedicationModal" class="fixed inset-0 z-50 overflow-y-auto" (click)="closeAddMedicationModal()">
  <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <!-- Background overlay -->
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

    <!-- Modal panel -->
    <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="bg-white px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center">
              <fa-icon [icon]="faPills" class="w-4 h-4 text-green-600"></fa-icon>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-900">Add New Medication</h3>
              <p class="text-sm text-gray-500">Enter medication details and dosage information</p>
            </div>
          </div>
          <button (click)="closeAddMedicationModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
            <fa-icon [icon]="faTimes" class="w-6 h-6"></fa-icon>
          </button>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="bg-white px-6 py-4">
        <form (ngSubmit)="addMedication()" #medicationForm="ngForm">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Medication Name -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faPills" class="w-4 h-4 mr-2 text-blue-600"></fa-icon>
                Medication Name *
              </label>
              <input type="text" [(ngModel)]="newMedication.name" name="name" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                     placeholder="e.g., Metformin, Lisinopril">
            </div>

            <!-- Dosage -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faExclamationTriangle" class="w-4 h-4 mr-2 text-orange-600"></fa-icon>
                Dosage *
              </label>
              <input type="text" [(ngModel)]="newMedication.dosage" name="dosage" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                     placeholder="e.g., 500mg, 10mg">
            </div>

            <!-- Frequency -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faCalendarAlt" class="w-4 h-4 mr-2 text-purple-600"></fa-icon>
                Frequency *
              </label>
              <select [(ngModel)]="newMedication.frequency" name="frequency" required
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">Select frequency</option>
                <option value="Once daily">Once daily</option>
                <option value="Twice daily">Twice daily</option>
                <option value="Three times daily">Three times daily</option>
                <option value="Four times daily">Four times daily</option>
                <option value="As needed">As needed</option>
                <option value="Weekly">Weekly</option>
                <option value="Monthly">Monthly</option>
              </select>
            </div>

            <!-- Times Per Day -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faCalendarAlt" class="w-4 h-4 mr-2 text-green-600"></fa-icon>
                Times Per Day
              </label>
              <input type="number" [(ngModel)]="newMedication.timesPerDay" name="timesPerDay" min="1" max="10"
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                     placeholder="e.g., 2">
            </div>

            <!-- Start Date -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faCalendarAlt" class="w-4 h-4 mr-2 text-blue-600"></fa-icon>
                Start Date *
              </label>
              <input type="date" [(ngModel)]="newMedication.startDate" name="startDate" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <!-- Prescribed By -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faUserMd" class="w-4 h-4 mr-2 text-indigo-600"></fa-icon>
                Prescribed By
              </label>
              <input type="text" [(ngModel)]="newMedication.prescribedBy" name="prescribedBy"
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                     placeholder="e.g., Dr. Smith">
            </div>

            <!-- Description -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faFileMedical" class="w-4 h-4 mr-2 text-teal-600"></fa-icon>
                Description
              </label>
              <textarea [(ngModel)]="newMedication.description" name="description" rows="2"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Brief description of the medication and its purpose..."></textarea>
            </div>

            <!-- Instructions -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faFileMedical" class="w-4 h-4 mr-2 text-amber-600"></fa-icon>
                Special Instructions
              </label>
              <textarea [(ngModel)]="newMedication.instructions" name="instructions" rows="2"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="e.g., Take with food, Take before bedtime, Avoid alcohol..."></textarea>
            </div>

            <!-- Side Effects -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faExclamationTriangle" class="w-4 h-4 mr-2 text-red-600"></fa-icon>
                Potential Side Effects
              </label>
              <textarea [(ngModel)]="newMedication.sideEffects" name="sideEffects" rows="2"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="e.g., Nausea, dizziness, headache..."></textarea>
            </div>

            <!-- Drug Interactions -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faExclamationTriangle" class="w-4 h-4 mr-2 text-orange-600"></fa-icon>
                Drug Interactions
              </label>
              <textarea [(ngModel)]="newMedication.interactions" name="interactions" rows="2"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="e.g., Avoid with blood thinners, Do not take with grapefruit..."></textarea>
            </div>

            <!-- Notes -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <fa-icon [icon]="faFileMedical" class="w-4 h-4 mr-2 text-gray-600"></fa-icon>
                Additional Notes
              </label>
              <textarea [(ngModel)]="newMedication.notes" name="notes" rows="3"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Any additional notes or observations..."></textarea>
            </div>
          </div>
        </form>
      </div>

      <!-- Modal Footer -->
      <div class="bg-gray-50 px-6 py-3 flex justify-end gap-3 border-t border-gray-200">
        <button (click)="closeAddMedicationModal()" class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
          Cancel
        </button>
        <button (click)="addMedication()" [disabled]="!isMedicationFormValid()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
          <fa-icon [icon]="faPlus" class="w-4 h-4"></fa-icon>
          Add Medication
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Document Viewer Modal -->
<app-document-viewer
  [isOpen]="showDocumentViewer"
  [document]="currentDocument"
  (closeEvent)="closeDocumentViewer()">
</app-document-viewer>

